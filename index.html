<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accesso al Database SQLite</title>
    <!-- Includi la libreria sql.js -->
    <script src="sql-wasm.js"></script>
</head>
<body>
    <h1>Dati dal Database SQLite</h1>

    <div id="output"></div>

    <script>
        // Function to load the database and perform query
        async function loadDatabaseAndQuery() {
            try {
                // Load the SQLite database file directly
                const response = await fetch('database.sqlite');
                const buffer = await response.arrayBuffer();
                
                // Initialize SQL.js with the database buffer
                const SQL = await initSqlJs({ locateFile: () => 'https://cdn.jsdelivr.net/npm/sql.js/dist/sql-wasm.wasm' });
                const db = new SQL.Database(new Uint8Array(buffer));

                // Execute a query to retrieve data
                const query = 'SELECT * FROM events;';
                const result = db.exec(query);
                const rows = result[0].values;

                // Display the results in HTML
                const outputDiv = document.getElementById('output');
                outputDiv.innerHTML = '<h2>Risultati:</h2>';
                outputDiv.innerHTML += '<ul>';
                rows.forEach(row => {
                    outputDiv.innerHTML += `<li>${row.join(', ')}</li>`;
                });
                outputDiv.innerHTML += '</ul>';

                // Close the database connection
                db.close();
            } catch (error) {
                console.error('Error loading database:', error);
            }
        }

        // Call the function to load the database and perform query
        loadDatabaseAndQuery();
    </script>
</body>
</html>